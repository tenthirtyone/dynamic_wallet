'use client'
import { Transaction, address } from 'bitcoinjs-lib';

/**
 * This method extracts the address from the input data of the psbt.
 * The address is stored as script (Buffer) in either the witnessUtxo or nonWitnessUtxo as an output
 */
const extractAddressFromInput = (psbt, index, input) => {
    var _a;
    let script;
    if ((_a = input.witnessUtxo) === null || _a === void 0 ? void 0 : _a.script) {
        // eslint-disable-next-line prefer-destructuring
        script = input.witnessUtxo.script;
    }
    else if (input.nonWitnessUtxo) {
        const nonWitnessTxn = Transaction.fromBuffer(input.nonWitnessUtxo);
        const txOut = nonWitnessTxn.outs[psbt.txInputs[index].index];
        // eslint-disable-next-line prefer-destructuring
        script = txOut.script;
    }
    if (!script)
        return;
    try {
        return address.fromOutputScript(script);
    }
    catch (e) {
        throw new Error('address not found in output script');
    }
};

export { extractAddressFromInput };
