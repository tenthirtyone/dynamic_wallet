'use client'
import { payments, Transaction } from 'bitcoinjs-lib';
import { logger } from '@dynamic-labs/wallet-connector-core';

/**
 * This method will return the signature hash type for the current input.
 * If there is a sighashType, it will return that
 * If there is a witnessUtxo AND it is a taproot address, then it will return SIGHASH_DEFAULT
 * Otherwise, it will return SIGHASH_ALL
 */
const getSigHashType = (input) => {
    var _a;
    if (input === null || input === void 0 ? void 0 : input.sighashType)
        return input.sighashType;
    let isTaprootAddress = false;
    if ((_a = input.witnessUtxo) === null || _a === void 0 ? void 0 : _a.script) {
        try {
            payments.p2tr({
                output: input.witnessUtxo.script,
            });
            isTaprootAddress = true;
        }
        catch (_) {
            logger.debug('address is not taproot');
        }
    }
    return isTaprootAddress
        ? Transaction.SIGHASH_DEFAULT
        : Transaction.SIGHASH_ALL;
};

export { getSigHashType };
